function initialize(){setMap()}function setMap(){function e(e,r,n){colorize=colorScale(r);for(var o=n.objects.FranceProvinces.geometries,i=0;i<r.length;i++)for(var s=r[i],c=s.adm1_code,l=0;l<o.length;l++)if(o[l].properties.adm1_code==c){for(var d in keyArray){var p=keyArray[d],h=parseFloat(s[p]);o[l].properties[p]=h}o[l].properties.name=s.name;break}t.append("path").datum(topojson.feature(n,n.objects.EuropeCountries)).attr("class","countries").attr("d",a),t.selectAll(".provinces").data(topojson.feature(n,n.objects.FranceProvinces).features).enter().append("g").attr("class","provinces").append("path").attr("class",function(e){return e.properties.adm1_code}).attr("d",a).style("fill",function(e){return choropleth(e,colorize)}).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel).append("desc").text(function(e){return choropleth(e,colorize)});createDropdown(r),setChart(r,colorize)}{var t=(d3.select("body").append("h1").text("France Provinces Choropleth"),d3.select("body").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","map")),r=d3.geo.albers().center([-8,46.2]).rotate([-10,0]).parallels([43,62]).scale(2900).translate([mapWidth/2,mapHeight/2]),a=d3.geo.path().projection(r),n=d3.geo.graticule().step([10,10]);t.append("path").datum(n.outline).attr("class","gratBackground").attr("d",a),t.selectAll(".gratLines").data(n.lines).enter().append("path").attr("class","gratLines").attr("d",a)}queue().defer(d3.csv,"data/unitsData.csv").defer(d3.json,"data/europe.topojson").await(e)}function createDropdown(e){var t=d3.select("body").append("div").attr("class","dropdown").html("<h3>Select Variable:</h3>").append("select").on("change",function(){changeAttribute(this.value,e)});t.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return e=e[0].toUpperCase()+e.substring(1,3)+" "+e.substring(3)})}function setChart(e){var t=d3.select("body").append("svg").attr("width",chartWidth).attr("height",chartHeight).attr("class","chart"),r=(t.append("text").attr("x",20).attr("y",40).attr("class","charttext"),t.selectAll(".bar").data(e).enter().append("rect").sort(function(e,t){return e[expressed]-t[expressed]}).attr("class",function(e){return"bar "+e.adm1_code}).attr("width",chartWidth/e.length-1).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel));updateChart(r,e.length)}function colorScale(e){var t=d3.scale.quantile().range(["#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"]);return t.domain([d3.min(e,function(e){return Number(e[expressed])}),d3.max(e,function(e){return Number(e[expressed])})]),t}function choropleth(e,t){var r=e.properties?e.properties[expressed]:e[expressed];return r?t(r):"#ccc"}function changeAttribute(e,t){expressed=e,d3.selectAll(".provinces").select("path").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)});var r=d3.selectAll(".bar").sort(function(e,t){return e[expressed]-t[expressed]}).transition().delay(function(e,t){return 10*t});updateChart(r,t.length)}function updateChart(e,t){e.attr("height",function(e){return 3*Number(e[expressed])}).attr("y",function(e){return chartHeight-3*Number(e[expressed])}).attr("x",function(e,r){return r*(chartWidth/t)}).style("fill",function(e){return choropleth(e,colorize)}),d3.select(".charttext").text("Number of "+expressed[0].toUpperCase()+expressed.substring(1,3)+" "+expressed.substring(3)+" In Each Province")}function format(e){return e="Population"!=expressed?"$"+roundRight(e):roundRight(e)}function roundRight(e){if(e>=100){var t=Math.round(e);return t.toLocaleString()}return 100>e&&e>=10?e.toPrecision(4):10>e&&e>=1?e.toPrecision(3):1>e?e.toPrecision(2):void 0}function highlight(e){var t=e.properties?e.properties:e;d3.selectAll("."+t.adm1_code).style("fill","#000");{var r="<h1>"+t[expressed]+"</h1><br><b>"+expressed+"</b>",a=t.name;d3.select("body").append("div").attr("class","infolabel").attr("id",t.adm1_code+"label").html(r).append("div").attr("class","labelname").html(a)}}function dehighlight(e){var t=e.properties?e.properties:e,r=d3.selectAll("."+t.adm1_code),a=r.select("desc").text();r.style("fill",a),d3.select("#"+t.adm1_code+"label").remove()}function moveLabel(){if(d3.event.clientX<window.innerWidth-245)var e=d3.event.clientX+10;else var e=d3.event.clientX-210;if(d3.event.clientY<window.innerHeight-100)var t=d3.event.clientY-75;else var t=d3.event.clientY-175;d3.select(".infolabel").style("margin-left",e+"px").style("margin-top",t+"px")}var keyArray=["varA","varB","varC","varD","varE"],expressed=keyArray[0],colorize,mapWidth=550,mapHeight=530,chartWidth=550,chartHeight=450;window.onload=initialize();